
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analysis of Principal Components x Demographic Factors &#8212; The Arts Engagement Project at The University of Michigan</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://artsengagementproject.site/analysis/pca-demographics.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Principal Components Analysis" href="pca.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://artsengagementproject.site/analysis/pca-demographics.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Analysis of Principal Components x Demographic Factors" />
<meta property="og:description" content="Analysis of Principal Components x Demographic Factors  In this notebook, principal components are generated from question topic prevalences and disctionary-bas" />
<meta property="og:image"       content="https://artsengagementproject.site/_static/logo.png" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">The Arts Engagement Project at The University of Michigan</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   The Arts Engagement Project
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Project Overview
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../overview/background.html">
   Project Background
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../overview/studydesign.html">
   Study Design
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../overview/studylogistics.html">
     Study Logistics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../overview/surveydesign.html">
     Survey Design
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../overview/datacollection.html">
     Data Collection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../overview/datadescription.html">
     Data Description
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../overview/presentations.html">
   Presentations and Publications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../overview/references.html">
   References &amp; Works Cited
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Insights
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../insights/insights.html">
   Insights Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../insights/descriptivestats.html">
   Descriptive Statistics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../insights/learning-outcomes.html">
   Learning Outcomes
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../insights/barriers.html">
   Barriers to Involvement
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../insights/barriers/tree.html">
     Barriers Topic Tree
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../insights/barriers/topics.html">
     Barriers Topic Descriptions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../insights/barriers/dimensions.html">
     Barriers Underlying Factors
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../insights/othergrowth.html">
   Personal Growth
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../insights/othergrowth/tree.html">
     Personal Growth Topic Tree
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../insights/othergrowth/topics.html">
     Personal Growth Topic Descriptions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../insights/othergrowth/dimensions.html">
     Personal Growth Underlying Factors
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../insights/feel.html">
   Emotional Impact
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../insights/feel/tree.html">
     Emotional Impacts Topic Tree
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../insights/feel/topics.html">
     Emotional Impacts Topic Descriptions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../insights/feel/dimensions.html">
     Emotional Impacts Underlying Factors
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../insights/development.html">
   Developmental Role
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../insights/development/tree.html">
     Developmental Role Topic Tree
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../insights/development/topics.html">
     Developmental Role Topic Descriptions
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../insights/role.html">
   College Experience
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../insights/role/tree.html">
     College Experience Topic Tree
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../insights/role/topics.html">
     College Experience Topic Descriptions
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../insights/experience/tree.html">
   Transformative Experiences
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Analyses
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="methods.html">
   Methods Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="topics.html">
   Topic Modeling and Interpretation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm-workflow.html">
   Structural Topic Model Workflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dictionaries.html">
   Dictionaries of Language Patterns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pca.html">
   Principal Components Analysis
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Analysis of Principal Components x Demographic Factors
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/analysis/pca-demographics.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/analysis/pca-demographics.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-libraries-and-data">
   Load libraries and data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#subset-demographic-variables">
   Subset demographic variables
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-helper-functions">
   Define helper functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#density-plots">
   Density Plots
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#marginal-plots">
   Marginal Plots
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#anova-emmeans">
   ANOVA, EMMeans
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#manova">
   MANOVA
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="analysis-of-principal-components-x-demographic-factors">
<h1>Analysis of Principal Components x Demographic Factors<a class="headerlink" href="#analysis-of-principal-components-x-demographic-factors" title="Permalink to this headline">¶</a></h1>
<p>In this notebook, principal components are generated from question topic prevalences and disctionary-based estimates of linguistic patterns — and their relationships to various demographic data are explored through statistical tests.</p>
<p>We used a Principle Components Analysis (PCA) in R (‘prcomp’ function) to integrate multiple variables and conduct an analysis for each question and set of responses. PCA is a multivariate statistical technique that extracts important information about the inter-correlations of multiple variables and re-represents that information as new variables called principle components. These new principle components can then be used to show the similarity and graphic relationships between variables as a way of exploring the data. Because PCA condenses multiple variables into fewer dimensions, the new principle components may also be used to integrate new descriptions of the combined variables. These reified principle components may then be used as covariates to estimate relationships with other variables such as demographic factors.</p>
<p>Twenty-seven dictionary-based variables (LIWC, AIC, and Docuscope) were not relevant and were excluded from the analysis, leaving a total of 221 dictionary-based variables in the PCA. This was in addition to the measures of topic prevalence, which each had different numbers of topic variables depending on the question/response type. In order to remove variables with high numbers of 0s (no observations), we set a 0.3 maximum threshold, leaving variable columns with 70% or more observations in the analysis. The number of responses and variables included for each question in the analysis are provided in Table 1. Because of the different scales used by the different dictionaries and topic measures (for example, topic prevalence is 0-1 while AIC is measured on a scale from 1-7), the PCA was based on a correlation matrix. The data were also centered around zero and rotated.</p>
<div class="section" id="load-libraries-and-data">
<h2>Load libraries and data<a class="headerlink" href="#load-libraries-and-data" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">FactoMineR</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">emmeans</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggExtra</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">load</span><span class="p">(</span><span class="s">&#39;../data/merged_artsengagement.rda&#39;</span><span class="p">)</span>
<span class="nf">load</span><span class="p">(</span><span class="s">&#39;../data/tidy_questions_best.Rda&#39;</span><span class="p">)</span>
<span class="nf">source</span><span class="p">(</span><span class="s">&#39;../scripts/select_helpers.R&#39;</span><span class="p">)</span>
<span class="nf">load</span><span class="p">(</span><span class="s">&#39;../data/pca_labels.rda&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="subset-demographic-variables">
<h2>Subset demographic variables<a class="headerlink" href="#subset-demographic-variables" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">motiv_demos</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">contains</span><span class="p">(</span><span class="s">&#39;sr_motivation&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">names</span>
<span class="n">identity_demos</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">contains</span><span class="p">(</span><span class="s">&#39;sr_identity&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">names</span>
<span class="n">participation_demos</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">all_arts</span><span class="p">(</span><span class="s">&#39;participation&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">starts_with</span><span class="p">(</span><span class="s">&#39;sr&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">names</span>
<span class="n">real_demos</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;ethnic_group&#39;</span><span class="p">,</span> <span class="s">&#39;sex&#39;</span><span class="p">,</span> <span class="s">&#39;school&#39;</span><span class="p">,</span> <span class="s">&#39;parented&#39;</span><span class="p">,</span> <span class="s">&#39;income&#39;</span><span class="p">,</span> <span class="s">&#39;artsincollege&#39;</span><span class="p">,</span> <span class="s">&#39;hstype&#39;</span><span class="p">,</span> <span class="s">&#39;hssize&#39;</span><span class="p">,</span>
           <span class="s">&#39;hslocation&#39;</span><span class="p">,</span> <span class="s">&#39;hs_arts_freq&#39;</span><span class="p">,</span> <span class="s">&#39;hs_encouragement&#39;</span><span class="p">,</span> <span class="s">&#39;hs_required&#39;</span><span class="p">,</span> <span class="s">&#39;hs_fees&#39;</span><span class="p">,</span>
           <span class="s">&#39;so_childhood1&#39;</span><span class="p">,</span> <span class="s">&#39;so_childhood3&#39;</span><span class="p">,</span> <span class="s">&#39;so_childhood5&#39;</span><span class="p">,</span> <span class="s">&#39;sr_participated&#39;</span><span class="p">,</span>
               <span class="s">&#39;sr_highestdegreeplanned&#39;</span><span class="p">)</span>
<span class="n">demo_groups</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;real_demos&#39;</span><span class="p">,</span><span class="s">&#39;motiv_demos&#39;</span><span class="p">,</span><span class="s">&#39;identity_demos&#39;</span><span class="p">,</span><span class="s">&#39;participation_demos&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">real_demo_prompts</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span>
    <span class="s">&#39;Ethnic Group&#39;</span><span class="p">,</span>
    <span class="s">&#39;Sex&#39;</span><span class="p">,</span>
    <span class="s">&#39;School&#39;</span><span class="p">,</span>
    <span class="s">&#39;Highest Parent\nEducation&#39;</span><span class="p">,</span>
    <span class="s">&#39;Family Income&#39;</span><span class="p">,</span>
    <span class="s">&#39;Prior to beginning college,\ndid you expect to be involved in the arts during college?&#39;</span><span class="p">,</span>
    <span class="s">&#39;High School Type&#39;</span><span class="p">,</span>
    <span class="s">&#39;High School Size&#39;</span><span class="p">,</span>
    <span class="s">&#39;High School Location&#39;</span><span class="p">,</span>
    <span class="s">&#39;How would you rate the frequency\nof your overall involvement\nin arts events and activities during high school?&#39;</span><span class="p">,</span>
    <span class="s">&#39;Were you encouraged by your high school to be involved in the arts?&#39;</span><span class="p">,</span>
    <span class="s">&#39;Were you required by your high school to be involved in the arts?&#39;</span><span class="p">,</span>
    <span class="s">&#39;Was there a fee associated with participation in arts activities at your high school?&#39;</span><span class="p">,</span>
    <span class="s">&#39;Were you involved in the arts during your childhood?&#39;</span><span class="p">,</span>
    <span class="s">&#39;During your childhood, did your parents sign you up for art classes of any kind?&#39;</span><span class="p">,</span>
    <span class="s">&#39;During your childhood, did your parents talk to you about the arts?&#39;</span><span class="p">,</span>
    <span class="s">&#39;Arts Participation Senior Year&#39;</span><span class="p">,</span>
    <span class="s">&#39;What is the\nhighest academic degree\nthat you intend on obtaining?&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="define-helper-functions">
<h2>Define helper functions<a class="headerlink" href="#define-helper-functions" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Used within the mergeQuestion function to merge variable names</span>
<span class="n">stripnames</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">data</span> <span class="o">&lt;-</span> <span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="s">&#39;rownums&#39;</span><span class="p">,</span> <span class="nf">starts_with</span><span class="p">(</span><span class="n">question</span><span class="p">))</span>
    <span class="n">varnames</span> <span class="o">&lt;-</span> <span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">newnames</span> <span class="o">&lt;-</span> <span class="n">varnames</span>
    <span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="nf">length</span><span class="p">(</span><span class="n">varnames</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">newnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">substr</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nf">gregexpr</span><span class="p">(</span><span class="s">&quot;\\.\\.&quot;</span><span class="p">,</span> <span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">])[[</span><span class="m">1</span><span class="p">]][</span><span class="m">1</span><span class="p">]</span><span class="m">+2</span><span class="p">,</span> <span class="nf">nchar</span><span class="p">(</span><span class="n">varnames</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="p">}</span>
    <span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">newnames</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Remove irrelavant variables</span>
<span class="n">stripVars</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">removenames</span> <span class="o">&lt;-</span> <span class="nf">names</span><span class="p">(</span><span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&quot;AIC..Words|AIC..IC_Differentiation|AIC..IC_Integration|AIC..DIAL_Differentiation|AIC..DIAL_Integration|AIC..ELAB_Differentiation|AIC..ELAB_Integration|docuscope..OralCues|docuscope..DialogCues|docuscope..XWordTokens|docuscope..XPunctuationTokens|docuscope..XTokens|LIWC..WC|LIWC..Sixltr|LIWC..Dic|LIWC..WPS|LIWC..swear|LIWC..netspeak|LIWC..assent|LIWC..nonflu|LIWC..filler|LIWC..AllPunc|LIWC..Period|LIWC..Comma|LIWC..Colon|LIWC..SemiC|LIWC..QMark|LIWC..Exclam|LIWC..Dash|LIWC..Quote|LIWC..Apostro|LIWC..Parenth|LIWC..OtherP&quot;</span><span class="p">)))</span>
    <span class="n">data</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">[</span> <span class="p">,</span> <span class="o">!</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">%in%</span> <span class="n">removenames</span><span class="p">]</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Merges responses between years</span>
<span class="n">mergeQuestion</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">if </span><span class="p">(</span><span class="nf">substr</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">question</span> <span class="o">&lt;-</span> <span class="nf">substr</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="nf">nchar</span><span class="p">(</span><span class="n">question</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="c1"># if you&#39;re aware of other prefixes, add them here</span>
    <span class="n">yrs</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="s">&#39;fl&#39;</span><span class="p">,</span><span class="s">&#39;f1&#39;</span><span class="p">,</span><span class="s">&#39;f2&#39;</span><span class="p">,</span><span class="s">&#39;so&#39;</span><span class="p">,</span><span class="s">&#39;jr&#39;</span><span class="p">,</span><span class="s">&#39;sr&#39;</span><span class="p">,</span><span class="s">&#39;sl&#39;</span><span class="p">)</span>
    <span class="n">data</span><span class="o">$</span><span class="n">rownums</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="c1"># add rownums so resulting data can be re-integrated</span>
    <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">()</span>
    <span class="nf">for </span><span class="p">(</span><span class="n">yr</span> <span class="n">in</span> <span class="n">yrs</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">if </span><span class="p">(</span><span class="n">question</span> <span class="o">==</span> <span class="s">&#39;definition&#39;</span> <span class="o">&amp;&amp;</span> <span class="nf">is.na</span><span class="p">(</span><span class="n">yr</span><span class="p">))</span>
            <span class="n">qyr</span> <span class="o">&lt;-</span> <span class="n">question</span>
        <span class="n">else</span> <span class="nf">if </span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">yr</span><span class="p">))</span>
            <span class="n">next</span>
        <span class="n">else</span> <span class="p">{</span>
            <span class="n">qyr</span> <span class="o">&lt;-</span> <span class="nf">paste0</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nf">if </span><span class="p">(</span><span class="n">data</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">starts_with</span><span class="p">(</span><span class="n">qyr</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">ncol</span> <span class="o">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span> <span class="n">next</span> <span class="p">}</span>
        <span class="n">tempdf</span> <span class="o">&lt;-</span> <span class="nf">stripnames</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">qyr</span><span class="p">)</span>
        <span class="nf">names</span><span class="p">(</span><span class="n">tempdf</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">question</span>
        <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">,</span> <span class="n">tempdf</span><span class="p">)</span>        
    <span class="p">}</span>
    <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="n">mergeddf</span><span class="p">[</span><span class="nf">complete.cases</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">),]</span>
    <span class="n">mergeddf</span> <span class="o">&lt;-</span> <span class="n">mergeddf</span> <span class="o">%&gt;%</span> <span class="n">stripVars</span>
    <span class="nf">rownames</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">()</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">mergeddf</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="density-plots">
<h2>Density Plots<a class="headerlink" href="#density-plots" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter demographics to those within min &amp; max levels (inclusive) into small_demos variable</span>
<span class="n">min</span> <span class="o">=</span> <span class="m">2</span>
<span class="n">max</span> <span class="o">=</span> <span class="m">5</span>
<span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">sapply</span><span class="p">(</span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)(</span><span class="n">x</span> <span class="o">%&gt;%</span> <span class="n">levels</span> <span class="o">%&gt;%</span> <span class="n">length</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span>
<span class="n">temp</span><span class="o">$</span><span class="n">demo</span> <span class="o">&lt;-</span> <span class="nf">rownames</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">temp</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">.</span> <span class="o">&gt;=</span> <span class="n">min</span> <span class="o">&amp;</span> <span class="n">max</span> <span class="o">&gt;=</span> <span class="n">.</span><span class="p">)</span>
<span class="n">small_demos</span> <span class="o">&lt;-</span> <span class="n">temp</span> <span class="o">%&gt;%</span> <span class="nf">pull</span><span class="p">(</span><span class="n">demo</span><span class="p">)</span>
<span class="n">small_demos</span>

<span class="n">dir_to_save_results</span> <span class="o">=</span> <span class="s">&#39;./results&#39;</span>
<span class="n">plot_type</span> <span class="o">=</span> <span class="s">&#39;density_plots&#39;</span> <span class="c1"># plural</span>
<span class="n">output_format</span> <span class="o">=</span> <span class="s">&#39;.png&#39;</span> <span class="c1"># with dot</span>

<span class="nf">dir.create</span><span class="p">(</span><span class="n">dir_to_save_results</span><span class="p">,</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
<span class="c1"># for all stm&#39;d questions</span>
<span class="nf">for</span><span class="p">(</span><span class="n">question</span> <span class="n">in</span> <span class="n">question_names</span><span class="p">[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="m">9</span><span class="o">:</span><span class="m">14</span><span class="p">)])</span> <span class="p">{</span>
    <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">dir_to_save_results</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
    
    <span class="c1"># data subsetting, PC creation</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="nf">mergeQuestion</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
    <span class="n">data_subset_rows</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span>
    <span class="n">percent</span> <span class="o">&lt;-</span> <span class="m">0.4</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[</span> <span class="nf">lapply</span><span class="p">(</span> <span class="n">data_subset</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="m">0</span><span class="p">)</span> <span class="o">/</span> <span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">percent</span> <span class="p">]</span>
                                       
    <span class="c1"># principal component generation</span>
    <span class="n">pd</span> <span class="o">&lt;-</span> <span class="nf">prcomp</span><span class="p">(</span><span class="n">data_subset</span><span class="p">,</span> <span class="n">retx</span><span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>

    <span class="c1"># merge PCs with demographic cols</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">rownum</span> <span class="o">=</span> <span class="n">data_subset_rows</span><span class="p">,</span> <span class="n">pd</span><span class="o">$</span><span class="n">x</span><span class="p">[,</span><span class="nf">seq</span><span class="p">(</span><span class="m">5</span><span class="p">)]</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span><span class="p">)</span>
    <span class="n">rownums</span> <span class="o">&lt;-</span> <span class="n">pcs</span><span class="o">$</span><span class="n">rownum</span> <span class="o">%&gt;%</span> <span class="n">sort</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">pcs</span> <span class="o">%&gt;%</span> <span class="nf">arrange</span><span class="p">(</span><span class="n">rownum</span><span class="p">)</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">pcs</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span>
    <span class="n">demodfpcs</span> <span class="o">&lt;-</span> <span class="nf">bind_cols</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">rownums</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="n">real_demos</span><span class="p">)],</span> <span class="n">pcs</span><span class="p">)</span>

    <span class="c1"># weighting by # of responses per respondent</span>
    <span class="n">resps_by_key</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span><span class="o">$</span><span class="n">key</span> <span class="o">%&gt;%</span> <span class="n">table</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span>
    <span class="nf">names</span><span class="p">(</span><span class="n">resps_by_key</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="s">&#39;n&#39;</span><span class="p">)</span>
    <span class="n">resps_by_key</span> <span class="o">%&lt;&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">n</span><span class="o">!=</span><span class="m">0</span><span class="p">)</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">r</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">nresps</span> <span class="o">&lt;-</span> <span class="n">resps_by_key</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">demodfpcs</span><span class="p">[</span><span class="n">r</span><span class="p">,]</span><span class="o">$</span><span class="n">key</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">.</span><span class="o">$</span><span class="n">n</span>
        <span class="n">demodfpcs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">,</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">)))]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">nresps</span><span class="p">)</span> <span class="o">*</span>
                                                        <span class="p">(</span><span class="n">demodfpcs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">,</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">)))])</span>
    <span class="p">}</span>
                                       
    <span class="c1"># separate PCs and demographics</span>
    <span class="n">demodfpcs</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="s">&#39;key&#39;</span><span class="p">)</span>
    <span class="n">demodf</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">))</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">))</span>
                                       
    <span class="c1"># plotting (by PC)</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">p</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="n">pcs</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1"># combine individual PC with demographics</span>
        <span class="n">temp</span> <span class="o">&lt;-</span> <span class="nf">bind_cols</span><span class="p">(</span><span class="n">pcs</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">demodf</span><span class="p">)</span>
        <span class="nf">names</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;pc&quot;</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">temp</span><span class="p">)[</span><span class="m">-1</span><span class="p">])</span>
        
        <span class="c1"># for each demographic...</span>
        <span class="nf">for</span><span class="p">(</span><span class="n">d</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="n">small_demos</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">mu</span> <span class="o">&lt;-</span> <span class="n">temp</span> <span class="o">%&gt;%</span> <span class="n">na.omit</span> <span class="o">%&gt;%</span> <span class="nf">group_by_at</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">small_demos</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span> <span class="o">%&gt;%</span>
                    <span class="nf">summarise</span><span class="p">(</span><span class="n">grp.median</span><span class="o">=</span><span class="nf">median</span><span class="p">(</span><span class="n">pc</span><span class="p">))</span>

            <span class="nf">ggplot</span><span class="p">(</span><span class="nf">na.omit</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">),</span> <span class="nf">aes_string</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)[</span><span class="n">p</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="n">small_demos</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span> <span class="o">+</span>
                <span class="nf">geom_density</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.4</span><span class="p">)</span> <span class="o">+</span>
                <span class="nf">xlim</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nf">na.omit</span><span class="p">(</span><span class="n">pcs</span><span class="p">[[</span><span class="n">p</span><span class="p">]])</span> <span class="o">%&gt;%</span> <span class="n">summary</span> <span class="o">%&gt;%</span> <span class="n">tidy</span> <span class="o">%&gt;%</span> <span class="n">.</span><span class="o">$</span><span class="n">minimum</span><span class="p">)</span><span class="m">-0.5</span><span class="p">,</span> 
                     <span class="nf">round</span><span class="p">(</span><span class="nf">na.omit</span><span class="p">(</span><span class="n">pcs</span><span class="p">[[</span><span class="n">p</span><span class="p">]])</span> <span class="o">%&gt;%</span> <span class="n">summary</span> <span class="o">%&gt;%</span> <span class="n">tidy</span> <span class="o">%&gt;%</span> <span class="n">.</span><span class="o">$</span><span class="n">maximum</span><span class="p">)</span><span class="m">+.5</span><span class="p">)</span> <span class="o">+</span>
                <span class="nf">geom_vline</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="nf">aes_string</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="s">&#39;grp.median&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nf">names</span><span class="p">(</span><span class="n">mu</span><span class="p">)[</span><span class="m">1</span><span class="p">]),</span>
                         <span class="n">linetype</span><span class="o">=</span><span class="s">&quot;dashed&quot;</span><span class="p">)</span> <span class="o">+</span>
                <span class="nf">labs</span><span class="p">(</span><span class="n">subtitle</span><span class="o">=</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&#39;pos-x: &#39;</span><span class="p">,</span> <span class="n">pca_labels</span> <span class="o">%&gt;%</span> 
                      <span class="nf">filter</span><span class="p">(</span><span class="n">question_name</span><span class="o">==</span><span class="n">question</span><span class="p">)</span> <span class="o">%&gt;%</span> 
                      <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;_pos&#39;</span><span class="p">)))</span> <span class="o">%&gt;%</span>
                      <span class="n">pull</span> <span class="o">%&gt;%</span> <span class="n">as.character</span><span class="p">,</span>
                     <span class="s">&#39;\nneg-x: &#39;</span><span class="p">,</span> <span class="n">pca_labels</span> <span class="o">%&gt;%</span> 
                      <span class="nf">filter</span><span class="p">(</span><span class="n">question_name</span><span class="o">==</span><span class="n">question</span><span class="p">)</span> <span class="o">%&gt;%</span> 
                      <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;_neg&#39;</span><span class="p">)))</span> <span class="o">%&gt;%</span>
                      <span class="n">pull</span> <span class="o">%&gt;%</span> <span class="n">as.character</span><span class="p">))</span> <span class="o">+</span>
                <span class="nf">theme</span><span class="p">(</span><span class="n">plot.subtitle</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">))</span>

            <span class="c1"># saving</span>
            <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">dir_to_save_results</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)[</span><span class="n">p</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
            <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">dir_to_save_results</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)[</span><span class="n">p</span><span class="p">],</span> <span class="n">plot_type</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
            <span class="nf">ggsave</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">dir_to_save_results</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)[</span><span class="n">p</span><span class="p">],</span> <span class="n">plot_type</span><span class="p">,</span> 
                         <span class="nf">paste0</span><span class="p">(</span><span class="n">small_demos</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">output_format</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">),</span> 
                   <span class="n">width</span> <span class="o">=</span> <span class="m">5</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="m">4</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="marginal-plots">
<h2>Marginal Plots<a class="headerlink" href="#marginal-plots" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">dir.create</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
<span class="nf">for</span><span class="p">(</span><span class="n">question</span> <span class="n">in</span> <span class="n">question_names</span><span class="p">[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="m">9</span><span class="o">:</span><span class="m">14</span><span class="p">,</span><span class="m">16</span><span class="p">)])</span> <span class="p">{</span>
    <span class="c1"># directories</span>
    <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
    
    <span class="c1"># data subsetting, PC</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="nf">mergeQuestion</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
    <span class="n">data_subset_rows</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span>
    <span class="n">percent</span> <span class="o">&lt;-</span> <span class="m">0.4</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[</span> <span class="nf">lapply</span><span class="p">(</span> <span class="n">data_subset</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="m">0</span><span class="p">)</span> <span class="o">/</span> <span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">percent</span> <span class="p">]</span>
    <span class="n">pd</span> <span class="o">&lt;-</span> <span class="nf">prcomp</span><span class="p">(</span><span class="n">data_subset</span><span class="p">,</span> <span class="n">retx</span><span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>

    <span class="c1"># merge with demographic cols</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">rownum</span> <span class="o">=</span> <span class="n">data_subset_rows</span><span class="p">,</span> <span class="n">pd</span><span class="o">$</span><span class="n">x</span><span class="p">[,</span><span class="nf">seq</span><span class="p">(</span><span class="m">5</span><span class="p">)]</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span><span class="p">)</span>
    <span class="n">rownums</span> <span class="o">&lt;-</span> <span class="n">pcs</span><span class="o">$</span><span class="n">rownum</span> <span class="o">%&gt;%</span> <span class="n">sort</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">pcs</span> <span class="o">%&gt;%</span> <span class="nf">arrange</span><span class="p">(</span><span class="n">rownum</span><span class="p">)</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">pcs</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span>
    <span class="n">demodfpcs</span> <span class="o">&lt;-</span> <span class="nf">bind_cols</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">rownums</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="n">real_demos</span><span class="p">)],</span> <span class="n">pcs</span><span class="p">)</span>

    <span class="c1"># weighting by # of responses per respondent</span>
    <span class="n">resps_by_key</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span><span class="o">$</span><span class="n">key</span> <span class="o">%&gt;%</span> <span class="n">table</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span>
    <span class="nf">names</span><span class="p">(</span><span class="n">resps_by_key</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="s">&#39;n&#39;</span><span class="p">)</span>
    <span class="n">resps_by_key</span> <span class="o">%&lt;&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">n</span><span class="o">!=</span><span class="m">0</span><span class="p">)</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">r</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">nresps</span> <span class="o">&lt;-</span> <span class="n">resps_by_key</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">demodfpcs</span><span class="p">[</span><span class="n">r</span><span class="p">,]</span><span class="o">$</span><span class="n">key</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">.</span><span class="o">$</span><span class="n">n</span>
        <span class="n">demodfpcs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">,</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">)))]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">nresps</span><span class="p">)</span> <span class="o">*</span>
                                                            <span class="p">(</span><span class="n">demodfpcs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">,</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">)))])</span>
    <span class="p">}</span>
    <span class="n">demodfpcs</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="s">&#39;key&#39;</span><span class="p">)</span>
    <span class="n">demodf</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">))</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">))</span>

    <span class="c1"># analysis</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">p</span> <span class="n">in</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1"># directories</span>
        <span class="n">cur_dir</span> <span class="o">&lt;-</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#39;pc&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s">&#39;_pc&#39;</span><span class="p">,</span> <span class="n">p</span><span class="m">+1</span><span class="p">,</span> <span class="s">&#39;_marginal_plots&#39;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="nf">dir.create</span><span class="p">(</span><span class="n">cur_dir</span><span class="p">,</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
        <span class="nf">for</span><span class="p">(</span><span class="n">d</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="n">demodf</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">temp</span> <span class="o">&lt;-</span> <span class="nf">bind_cols</span><span class="p">(</span><span class="n">pcs</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">pcs</span><span class="p">[</span><span class="n">p</span><span class="m">+1</span><span class="p">],</span> <span class="n">demodf</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
            <span class="nf">names</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&#39;pc0&#39;</span><span class="p">),</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&#39;pc00&#39;</span><span class="p">),</span><span class="s">&#39;demo&#39;</span><span class="p">)</span> <span class="c1"># for easier ggplot column selection</span>
            <span class="nf">if</span><span class="p">((</span><span class="n">temp</span><span class="o">$</span><span class="n">demo</span> <span class="o">%&gt;%</span> <span class="n">table</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">Freq</span> <span class="o">!=</span> <span class="m">0</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">nrow</span><span class="p">)</span> <span class="o">==</span> <span class="m">1</span><span class="p">)</span> <span class="n">next</span>

            <span class="n">pca_idx</span> <span class="o">&lt;-</span> <span class="m">0</span>
            <span class="nf">if </span><span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">pca_idx</span> <span class="o">&lt;-</span> <span class="m">2</span>
            <span class="p">}</span>
            <span class="nf">if </span><span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="m">3</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">pca_idx</span> <span class="o">&lt;-</span> <span class="m">6</span>
            <span class="p">}</span>
            
            <span class="c1"># hexbins</span>
            <span class="n">plot</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">temp</span> <span class="o">%&gt;%</span> <span class="n">na.omit</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pc0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">pc00</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">demo</span><span class="p">))</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">4</span><span class="o">/</span><span class="m">10</span><span class="p">)</span> <span class="o">+</span>
              <span class="nf">labs</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">real_demo_prompts</span><span class="p">[</span><span class="n">d</span><span class="p">])</span> <span class="o">+</span>
              <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">22</span><span class="p">))</span> <span class="o">+</span>
              <span class="nf">xlab</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">pca_labels</span><span class="p">,</span> <span class="n">question_name</span> <span class="o">==</span> <span class="n">question</span><span class="p">)[[</span><span class="n">pca_idx</span><span class="m">+1</span><span class="p">]]),</span>
                 <span class="s">&#39; (-) v. &#39;</span><span class="p">,</span>
                 <span class="nf">as.character</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">pca_labels</span><span class="p">,</span><span class="n">question_name</span> <span class="o">==</span> <span class="n">question</span><span class="p">)[[</span><span class="n">pca_idx</span><span class="p">]]),</span> <span class="s">&#39; (+)&#39;</span><span class="p">))</span> <span class="o">+</span>
              <span class="nf">ylab</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">pca_labels</span><span class="p">,</span><span class="n">question_name</span> <span class="o">==</span> <span class="n">question</span><span class="p">)[[</span><span class="n">pca_idx</span><span class="m">+3</span><span class="p">]]),</span>
                 <span class="s">&#39; (-) v. &#39;</span><span class="p">,</span>
                 <span class="nf">as.character</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">pca_labels</span><span class="p">,</span><span class="n">question_name</span> <span class="o">==</span> <span class="n">question</span><span class="p">)[[</span><span class="n">pca_idx</span><span class="m">+2</span><span class="p">]]),</span> <span class="s">&#39; (+)&#39;</span><span class="p">))</span>
            
            <span class="nf">if </span><span class="p">((</span><span class="n">question</span> <span class="o">==</span> <span class="s">&#39;sr_othergrowth&#39;</span> <span class="o">||</span> <span class="n">question</span> <span class="o">==</span> <span class="s">&#39;sr_society&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">p</span> <span class="o">==</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">plot</span> <span class="o">&lt;-</span> <span class="n">plot</span> <span class="o">+</span> <span class="nf">xlab</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">pca_labels</span><span class="p">,</span><span class="n">question_name</span> <span class="o">==</span> <span class="n">question</span><span class="p">)</span><span class="o">$</span><span class="n">pc1_neg</span><span class="p">),</span>
                 <span class="s">&#39; (-) v.\n&#39;</span><span class="p">,</span>
                 <span class="nf">as.character</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">pca_labels</span><span class="p">,</span><span class="n">question_name</span> <span class="o">==</span> <span class="n">question</span><span class="p">)</span><span class="o">$</span><span class="n">pc1_pos</span><span class="p">),</span> <span class="s">&#39; (+)&#39;</span><span class="p">))</span>
            <span class="p">}</span>
            
            <span class="n">plot</span> <span class="o">&lt;-</span> <span class="nf">ggMarginal</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&#39;density&#39;</span><span class="p">,</span> <span class="n">groupColour</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
            
            <span class="n">size</span> <span class="o">&lt;-</span> <span class="m">1248</span>
            <span class="nf">if </span><span class="p">(</span><span class="n">d</span> <span class="o">==</span> <span class="m">3</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># school index</span>
                <span class="n">size</span> <span class="o">&lt;-</span> <span class="n">size</span> <span class="o">*</span> <span class="m">1.5</span>
            <span class="p">}</span>
            <span class="nf">png</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">cur_dir</span><span class="p">,</span> <span class="s">&#39;/pc&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s">&#39;_pc&#39;</span><span class="p">,</span> <span class="n">p</span><span class="m">+1</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="n">demodf</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">%&gt;%</span> <span class="n">names</span><span class="p">,</span> <span class="s">&#39;.png&#39;</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&quot;px&quot;</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
            <span class="nf">dev.off</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="anova-emmeans">
<h2>ANOVA, EMMeans<a class="headerlink" href="#anova-emmeans" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sig_contrasts.demos</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">()</span>
<span class="n">sig_aov_posthoc</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">()</span>
<span class="nf">dir.create</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
<span class="nf">for</span><span class="p">(</span><span class="n">question</span> <span class="n">in</span> <span class="n">question_names</span><span class="p">[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="m">9</span><span class="o">:</span><span class="m">14</span><span class="p">)])</span> <span class="p">{</span>
    <span class="c1"># directories</span>
    <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
    
    <span class="c1"># data subsetting</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="nf">mergeQuestion</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
    <span class="n">data_subset_rows</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span>
    <span class="n">percent</span> <span class="o">&lt;-</span> <span class="m">0.4</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[</span> <span class="nf">lapply</span><span class="p">(</span> <span class="n">data_subset</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="m">0</span><span class="p">)</span> <span class="o">/</span> <span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">percent</span> <span class="p">]</span>
                                       
    <span class="c1"># generate principal components</span>
    <span class="n">pd</span> <span class="o">&lt;-</span> <span class="nf">prcomp</span><span class="p">(</span><span class="n">data_subset</span><span class="p">,</span> <span class="n">retx</span><span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>

    <span class="c1"># merge with demographic cols</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">rownum</span> <span class="o">=</span> <span class="n">data_subset_rows</span><span class="p">,</span> <span class="n">pd</span><span class="o">$</span><span class="n">x</span><span class="p">[,</span><span class="nf">seq</span><span class="p">(</span><span class="m">5</span><span class="p">)]</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span><span class="p">)</span>
    <span class="n">rownums</span> <span class="o">&lt;-</span> <span class="n">pcs</span><span class="o">$</span><span class="n">rownum</span> <span class="o">%&gt;%</span> <span class="n">sort</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">pcs</span> <span class="o">%&gt;%</span> <span class="nf">arrange</span><span class="p">(</span><span class="n">rownum</span><span class="p">)</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">pcs</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span>
    <span class="n">demodfpcs</span> <span class="o">&lt;-</span> <span class="nf">bind_cols</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">rownums</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="n">real_demos</span><span class="p">)],</span> <span class="n">pcs</span><span class="p">)</span>

    <span class="c1"># weighting by # of responses per respondent</span>
    <span class="c1"># ( each respondent has up to 4 responses per question, and each response is given a weight between 1/4 and 1 )</span>
    <span class="n">resps_by_key</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span><span class="o">$</span><span class="n">key</span> <span class="o">%&gt;%</span> <span class="n">table</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span>
    <span class="nf">names</span><span class="p">(</span><span class="n">resps_by_key</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="s">&#39;n&#39;</span><span class="p">)</span>
    <span class="n">resps_by_key</span> <span class="o">%&lt;&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">n</span><span class="o">!=</span><span class="m">0</span><span class="p">)</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">r</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">nresps</span> <span class="o">&lt;-</span> <span class="n">resps_by_key</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">demodfpcs</span><span class="p">[</span><span class="n">r</span><span class="p">,]</span><span class="o">$</span><span class="n">key</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">.</span><span class="o">$</span><span class="n">n</span>
        <span class="n">demodfpcs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">,</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">)))]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">nresps</span><span class="p">)</span> <span class="o">*</span>
                                                            <span class="p">(</span><span class="n">demodfpcs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">,</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">)))])</span>
    <span class="p">}</span>
    <span class="n">demodfpcs</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="s">&#39;key&#39;</span><span class="p">)</span>
    <span class="n">demodf</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">))</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">))</span>

    <span class="c1"># analysis</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">p</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="n">pcs</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1"># creating directories</span>
        <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)[</span><span class="n">p</span><span class="p">],</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
        <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)[</span><span class="n">p</span><span class="p">],</span> <span class="s">&#39;emmeans&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
        <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)[</span><span class="n">p</span><span class="p">],</span> <span class="s">&#39;anova_tukey&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
        <span class="nf">for</span><span class="p">(</span><span class="n">d</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="n">demodf</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">temp</span> <span class="o">&lt;-</span> <span class="nf">bind_cols</span><span class="p">(</span><span class="n">pcs</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">demodf</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
            <span class="nf">names</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;pc&#39;</span><span class="p">,</span><span class="s">&#39;demo&#39;</span><span class="p">)</span>
            <span class="nf">if</span><span class="p">((</span><span class="n">temp</span><span class="o">$</span><span class="n">demo</span> <span class="o">%&gt;%</span> <span class="n">table</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">Freq</span> <span class="o">!=</span> <span class="m">0</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">nrow</span><span class="p">)</span> <span class="o">==</span> <span class="m">1</span><span class="p">)</span> <span class="n">next</span>

            <span class="c1"># emmeans contrasts</span>
            <span class="n">lm.out</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">pc</span> <span class="o">~</span> <span class="n">demo</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp</span><span class="p">,</span> <span class="n">na.action</span> <span class="o">=</span> <span class="n">na.exclude</span><span class="p">)</span>
            <span class="n">em.out</span> <span class="o">&lt;-</span> <span class="nf">emmeans</span><span class="p">(</span><span class="n">lm.out</span><span class="p">,</span> <span class="o">~</span> <span class="n">demo</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="s">&#39;proportional&#39;</span><span class="p">)</span>
            <span class="n">contrast.out</span> <span class="o">&lt;-</span> <span class="nf">contrast</span><span class="p">(</span><span class="n">em.out</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;del.eff&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">tidy</span>

            <span class="n">contrast.out</span><span class="o">$</span><span class="n">p.value</span> <span class="o">%&lt;&gt;%</span> <span class="nf">p.adjust</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s">&#39;holm&#39;</span><span class="p">)</span>
            <span class="n">contrast.out</span> <span class="o">%&lt;&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">question_name</span><span class="o">=</span><span class="n">question</span><span class="p">,</span>
                                        <span class="n">PC_num</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#39;PC&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span> 
                                        <span class="n">PC_pos</span> <span class="o">=</span> <span class="n">pca_labels</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">filter</span><span class="p">(</span><span class="n">question_name</span><span class="o">==</span><span class="n">question</span><span class="p">)</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;_pos&#39;</span><span class="p">)))</span> <span class="o">%&gt;%</span>
                                                  <span class="n">pull</span> <span class="o">%&gt;%</span> <span class="n">as.character</span><span class="p">,</span>
                                        <span class="n">PC_neg</span> <span class="o">=</span> <span class="n">pca_labels</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">filter</span><span class="p">(</span><span class="n">question_name</span><span class="o">==</span><span class="n">question</span><span class="p">)</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;_neg&#39;</span><span class="p">)))</span> <span class="o">%&gt;%</span>
                                                  <span class="n">pull</span> <span class="o">%&gt;%</span> <span class="n">as.character</span><span class="p">,</span>
                                        <span class="n">demographic</span> <span class="o">=</span> <span class="nf">names</span><span class="p">(</span><span class="n">demodf</span><span class="p">)[</span><span class="n">d</span><span class="p">]</span>
                                     <span class="p">)</span>            

            <span class="c1"># anova tukey</span>
            <span class="n">aov.out</span> <span class="o">&lt;-</span> <span class="nf">aov</span><span class="p">(</span><span class="n">pc</span> <span class="o">~</span> <span class="n">demo</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">TukeyHSD</span> <span class="o">%&gt;%</span> <span class="n">tidy</span>
            <span class="n">aov.out</span> <span class="o">%&lt;&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">term</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">question_name</span><span class="o">=</span><span class="n">question</span><span class="p">,</span>
                                        <span class="n">PC_num</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#39;PC&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span> 
                                        <span class="n">PC_pos</span> <span class="o">=</span> <span class="n">pca_labels</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">filter</span><span class="p">(</span><span class="n">question_name</span><span class="o">==</span><span class="n">question</span><span class="p">)</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;_pos&#39;</span><span class="p">)))</span> <span class="o">%&gt;%</span>
                                                  <span class="n">pull</span> <span class="o">%&gt;%</span> <span class="n">as.character</span><span class="p">,</span>
                                        <span class="n">PC_neg</span> <span class="o">=</span> <span class="n">pca_labels</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">filter</span><span class="p">(</span><span class="n">question_name</span><span class="o">==</span><span class="n">question</span><span class="p">)</span> <span class="o">%&gt;%</span> 
                                                  <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;_neg&#39;</span><span class="p">)))</span> <span class="o">%&gt;%</span>
                                                  <span class="n">pull</span> <span class="o">%&gt;%</span> <span class="n">as.character</span><span class="p">,</span>
                                        <span class="n">demographic</span> <span class="o">=</span> <span class="nf">names</span><span class="p">(</span><span class="n">demodf</span><span class="p">)[</span><span class="n">d</span><span class="p">]</span>
                                     <span class="p">)</span>
            
            <span class="c1"># bind rows</span>
            <span class="nf">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span>
            <span class="n">sig_contrasts.demos</span> <span class="o">%&lt;&gt;%</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">contrast.out</span><span class="p">)</span>
            <span class="n">sig_aov_posthoc</span> <span class="o">%&lt;&gt;%</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">aov.out</span><span class="p">)</span>
            <span class="nf">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="m">0</span><span class="p">)</span>
            
            <span class="c1"># write csvs</span>
            <span class="nf">write.csv</span><span class="p">(</span><span class="n">contrast.out</span><span class="p">,</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span><span class="n">question</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)[</span><span class="n">p</span><span class="p">],</span><span class="s">&#39;emmeans&#39;</span><span class="p">,</span><span class="nf">paste0</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">demodf</span><span class="p">)[</span><span class="n">d</span><span class="p">],</span><span class="s">&#39;.csv&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">))</span>
            <span class="nf">write.csv</span><span class="p">(</span><span class="n">aov.out</span><span class="p">,</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span><span class="n">question</span><span class="p">,</span><span class="nf">names</span><span class="p">(</span><span class="n">pcs</span><span class="p">)[</span><span class="n">p</span><span class="p">],</span><span class="s">&#39;anova_tukey&#39;</span><span class="p">,</span><span class="nf">paste0</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">demodf</span><span class="p">)[</span><span class="n">d</span><span class="p">],</span><span class="s">&#39;.csv&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1"># # write rdas</span>
<span class="nf">save</span><span class="p">(</span><span class="n">sig_contrasts.demos</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s">&#39;./results/emmeans_contrasts.rda&#39;</span><span class="p">)</span>
<span class="nf">save</span><span class="p">(</span><span class="n">sig_aov_posthoc</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s">&#39;./results/anova_tukey.rda&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="manova">
<h2>MANOVA<a class="headerlink" href="#manova" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># skip aftercollege bc it causes errors (index 7)</span>
<span class="nf">for</span><span class="p">(</span><span class="n">question</span> <span class="nf">in </span><span class="p">(</span><span class="n">question_names</span><span class="p">[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="m">9</span><span class="o">:</span><span class="m">14</span><span class="p">)])[</span><span class="m">-7</span><span class="p">])</span> <span class="p">{</span>
    <span class="c1"># directories</span>
    <span class="nf">dir.create</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
    
    <span class="c1"># data subsetting, PC</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="nf">mergeQuestion</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
    <span class="n">data_subset_rows</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span>
    <span class="n">percent</span> <span class="o">&lt;-</span> <span class="m">0.4</span>
    <span class="n">data_subset</span> <span class="o">&lt;-</span> <span class="n">data_subset</span><span class="p">[</span> <span class="nf">lapply</span><span class="p">(</span> <span class="n">data_subset</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="m">0</span><span class="p">)</span> <span class="o">/</span> <span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">percent</span> <span class="p">]</span>
    <span class="n">pd</span> <span class="o">&lt;-</span> <span class="nf">prcomp</span><span class="p">(</span><span class="n">data_subset</span><span class="p">,</span> <span class="n">retx</span><span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>

    <span class="c1"># merge with demographic cols</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">rownum</span> <span class="o">=</span> <span class="n">data_subset_rows</span><span class="p">,</span> <span class="n">pd</span><span class="o">$</span><span class="n">x</span><span class="p">[,</span><span class="nf">seq</span><span class="p">(</span><span class="m">5</span><span class="p">)]</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span><span class="p">)</span>
    <span class="n">rownums</span> <span class="o">&lt;-</span> <span class="n">pcs</span><span class="o">$</span><span class="n">rownum</span> <span class="o">%&gt;%</span> <span class="n">sort</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">pcs</span> <span class="o">%&gt;%</span> <span class="nf">arrange</span><span class="p">(</span><span class="n">rownum</span><span class="p">)</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">pcs</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span>
    <span class="n">demodfpcs</span> <span class="o">&lt;-</span> <span class="nf">bind_cols</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">rownums</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="n">real_demos</span><span class="p">)],</span> <span class="n">pcs</span><span class="p">)</span>

    <span class="c1"># weighting by # of responses per respondent</span>
    <span class="n">resps_by_key</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span><span class="o">$</span><span class="n">key</span> <span class="o">%&gt;%</span> <span class="n">table</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span>
    <span class="nf">names</span><span class="p">(</span><span class="n">resps_by_key</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="s">&#39;n&#39;</span><span class="p">)</span>
    <span class="n">resps_by_key</span> <span class="o">%&lt;&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">n</span><span class="o">!=</span><span class="m">0</span><span class="p">)</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">r</span> <span class="n">in</span> <span class="nf">seq</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">nresps</span> <span class="o">&lt;-</span> <span class="n">resps_by_key</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">demodfpcs</span><span class="p">[</span><span class="n">r</span><span class="p">,]</span><span class="o">$</span><span class="n">key</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">.</span><span class="o">$</span><span class="n">n</span>
        <span class="n">demodfpcs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">,</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">)))]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">nresps</span><span class="p">)</span> <span class="o">*</span>
                                                            <span class="p">(</span><span class="n">demodfpcs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="nf">names</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">demodfpcs</span><span class="p">,</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">)))])</span>
    <span class="p">}</span>
    <span class="n">demodfpcs</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="s">&#39;key&#39;</span><span class="p">)</span>
    <span class="n">demodf</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">))</span>
    <span class="n">pcs</span> <span class="o">&lt;-</span> <span class="n">demodfpcs</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#39;PC[12345]&#39;</span><span class="p">))</span>

    <span class="c1"># manova</span>
    <span class="n">demo_level_nums</span> <span class="o">&lt;-</span> <span class="n">demodf</span> <span class="o">%&gt;%</span> <span class="n">na.omit</span> <span class="o">%&gt;%</span> <span class="nf">sapply</span><span class="p">(</span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)(</span><span class="n">x</span> <span class="o">%&gt;%</span> <span class="n">table</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">Freq</span> <span class="o">!=</span> <span class="m">0</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">nrow</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">as.data.frame</span>
    <span class="n">demo_level_nums</span><span class="o">$</span><span class="n">demo</span> <span class="o">&lt;-</span> <span class="nf">rownames</span><span class="p">(</span><span class="n">demo_level_nums</span><span class="p">)</span>
    <span class="nf">names</span><span class="p">(</span><span class="n">demo_level_nums</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;n&#39;</span><span class="p">,</span><span class="s">&#39;demo&#39;</span><span class="p">)</span>
    <span class="n">filter_list</span> <span class="o">&lt;-</span> <span class="n">demo_level_nums</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="m">2</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">pull</span><span class="p">(</span><span class="n">demo</span><span class="p">)</span>
    <span class="n">man_demodf</span> <span class="o">&lt;-</span> <span class="n">demodf</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">filter_list</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">man_demodf</span><span class="p">))</span>
    <span class="n">man.out</span> <span class="o">&lt;-</span> <span class="nf">manova</span><span class="p">(</span><span class="n">pcs</span> <span class="o">%&gt;%</span> <span class="n">as.matrix</span> <span class="o">~</span> <span class="n">.</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">man_demodf</span><span class="p">)</span>
                                                     
    <span class="c1"># write csv</span>
    <span class="nf">write.csv</span><span class="p">(</span><span class="nf">tidy</span><span class="p">(</span><span class="n">man.out</span><span class="p">),</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span><span class="n">question</span><span class="p">,</span><span class="s">&#39;manova_table.csv&#39;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">))</span>
    <span class="nf">sink</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;./results&#39;</span><span class="p">,</span><span class="n">question</span><span class="p">,</span><span class="s">&#39;manova_output.txt&#39;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">))</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">man.out</span><span class="p">)</span>
    <span class="nf">sink</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./analysis"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="pca.html" title="previous page">Principal Components Analysis</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-44678143-2', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>